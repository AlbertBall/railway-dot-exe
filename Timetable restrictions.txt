Extracted from an email to JasonB on 16/02/24

The puzzles you mention are due to restrictions imposed by the timetable validator, which unfortunately isn't as flexible as real life, where you can pretty much do what you like with regard to timetabling.

First restriction:  Can't have a service that links more than once to another service [not quite true, shuttles can but they are a special case].  Clearly this is possible in real life, but in order for the validator to link services together correctly all linked service references (up to eight characters, the last four of which represent the headcode) are required to be unique.  If they aren't then there's a danger that an incorrect link will be made.  This restriction is applied at the service level, so a service that attempts to link more than once to another service conflicts with this requirement.  To help offset this restriction I extended the headcode to allow four extra characters and called that a 'service reference', so that during operation the same headcode can link to any number of other services as many times as are required, provided that the uniqueness is in the extra characters - as you say by using '1-' or something similar as a prefix.

Second restriction:  Can't have an Fns command following an Sns or Sfs command without at least one arrival between them (i.e. they can't both occur at the same location).  This is often encountered in the situation you describe, where a loco runs round a train and rejoins at the other end.  The reason for this is that the validator has to identify the location name for every timetabled event that occurs at a location (so the performance log and floating information window can record the event correctly during operation).  It does this by first naming the location for all Fns events, by working back through the service's timetable until it finds either an earlier arrival, which is named explicitly when the timetable is created, or an Snt event that occurs at a location.  After that it looks for the corresponding Sns event and gives it the same name as the Fns event.  Then it looks for all splits (fsp & rsp) and names them in the same way as it does the Fns events, then names the corresponding Sfs event in the same way.  Therefore an Fns following an Sns or Sfs event can't be named, because the Sfs or Sns event hasn't yet been given a name.  Validating a timetable is often a frustrating business because of these (and other) restrictions, I myself often fall foul of them and feel like tearing my hair out even though I wrote the code!  So I strongly sympathise with others in the same boat.

Now, with regard to loco run-arounds as at Edinburgh: the validator requires that after the split either the loco or the stock changes its service reference before the rejoin, because a service can't split and then rejoin the same service reference. Also, as described above, a train that splits off from another (begins with Sfs) can't immediately change to a new service (i.e. can't end with Fns). The way to deal with this is to have the split-off train finish with Fjo, and the original train change to a new service then have the split-off train rejoin it using jbo. Therefore in the case of a runaround there are two possibilities: (a) the loco splits off from the stock, runs around via another location where it stops and changes direction, and rejoins the stock using Fjo, and the stock changes to a new service then has the loco rejoin it using jbo; or (b) the stock splits off from the loco and rejoins the loco using Fjo, and the loco changes to a new service, runs round the stock via another location as before, then has the stock rejoin it using jbo.

Phew!!  I hope all that makes some sort of sense, and that it helps in your Edinburgh/Haymarket case.

If you still have problems please let me know and I'll try to help in devising suitable timetable entries.


In a later email of 19/02/24:

But please be aware of the other two restrictions: (1) can't have a service both split from another and then rejoin it without one or other changing to a new service (otherwise there would be two links to the same service and that isn't permitted); and (2) an Fns command can't follow Sfs or Sns commands without an arrival between them (i.e. they can't both occur at the same location or the validator won't be able to determine the Fns location).  Therefore in timetabling a run-around you will need to make sure that the part (either loco or carriages) that splits off from the original train (loco + carriages) is not the one that becomes the new service, otherwise you will have the Fns command follow a Sfs command at the same location and that isn't permitted.  So the split-off train needs to finish with Fjo, and the original train is the one that changes to a new service then has the split-off train rejoin it using jbo.




